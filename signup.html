<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>POAdda Registration</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
body{
  font-family:'Segoe UI',sans-serif;
  margin:0;
  padding:20px;
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  background:linear-gradient(135deg,#f9d423,#ff4e50);
}

.container{
  width:100%;
  max-width:520px; /* â¬… increased width */
}

.logo{
  text-align:center;
  margin-bottom:10px;
}
.logo img{
  max-width:140px;
}

form{
  background:#fff;
  padding:28px;
  border-radius:20px;
  box-shadow:0 15px 40px rgba(0,0,0,0.4);
}

h2,h4{text-align:center;margin:0}
h2{color:#fff}
h4{color:#eee;margin-bottom:20px}

label{
  font-weight:600;
  margin-top:12px;
  display:block;
}

input,select{
  width:100%;
  padding:12px;
  margin-top:6px;
  border-radius:12px;
  border:1px solid #ccc;
  font-size:14px;
}

.hint{
  font-size:12px;
  color:#666;
  margin-top:4px;
}

button{
  width:100%;
  padding:14px;
  margin-top:18px;
  border:none;
  border-radius:14px;
  font-size:16px;
  font-weight:bold;
  cursor:pointer;
  color:#fff;
  background:linear-gradient(135deg,#4facfe,#00f2fe);
  position:relative;
}

button:disabled{
  opacity:0.7;
  cursor:not-allowed;
}

.spinner{
  display:none;
  position:absolute;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%);
}

.back-btn{
  background:#6c757d;
}

.notifier{
  position:fixed;
  top:-80px;
  left:50%;
  transform:translateX(-50%);
  padding:12px 20px;
  border-radius:10px;
  font-weight:bold;
  color:#fff;
  transition:.5s;
  z-index:9999;
}
.notifier.show{top:20px}
.success{background:#28a745}
.warning{background:#ffc107;color:#000}

#successView{
  display:none;
  text-align:center;
  color:#fff;
}

</style>
<style>
.password-wrap{
  position:relative;
}

.password-wrap i{
  position:absolute;
  right:14px;
  top:50%;
  transform:translateY(-50%);
  cursor:pointer;
  color:#666;
}
</style>

</head>

<body>

<div class="container">

  <div class="logo">
    <img src="logo.png" alt="POADDA Logo">
  </div>

  <h2><i class="fa fa-user-plus"></i> POAdda Registration</h2>
  <h4>A journey towards excellence</h4>

  <!-- SUCCESS VIEW -->
  <div id="successView">
    <h3>Welcome to POADDA ðŸŽ‰</h3>
    <p><b>Name:</b> <span id="sName"></span></p>
    <p><b>Mobile:</b> <span id="sMobile"></span></p>
    <p><b>Password:</b> <span id="sPassword"></span></p>

    <button onclick="location.href='login.html'">Go to Login</button>
    <button onclick="location.href='home.html'" style="margin-top:10px;">Go to Home</button>
  </div>

  <!-- FORM -->
  <form id="signupForm">

    <label>Full Name</label>
    <input type="text" name="name" required>
    <div class="hint">Enter your full name</div>

    <label>Mobile Number</label>
    <input id="mobile" type="text" name="mobile" maxlength="10" required>
    <div class="hint">10-digit mobile number only</div>

   <label>Password</label>
<div class="password-wrap">
  <input type="password" id="password" name="password" required>
  <i class="fa fa-eye" onclick="togglePassword('password',this)"></i>
</div>
<div class="hint">Minimum 6 characters, letters & numbers</div>

<label>Confirm Password</label>
<div class="password-wrap">
  <input type="password" id="confirmPassword" name="confirmPassword" required>
  <i class="fa fa-eye" onclick="togglePassword('confirmPassword',this)"></i>
</div>


    <label>Exam</label>
    <select name="exam" required>
      <option value="">Select Exam</option>
      <option>IPO</option>
      <option>PA/SA</option>
      <option>POSTMAN</option>
      <option>MTS</option>
    </select>

    <button id="submitBtn" type="submit">
      <span id="btnText">Submit</span>
      <span class="spinner" id="btnSpinner">
        <i class="fa fa-spinner fa-spin"></i>
      </span>
    </button>

    <button type="button" class="back-btn" onclick="location.href='user.html'">Back</button>

  </form>
</div>

<div id="notifier" class="notifier"></div>

<script>
function togglePassword(id, icon){
  const input = document.getElementById(id);
  if(input.type === "password"){
    input.type = "text";
    icon.classList.remove("fa-eye");
    icon.classList.add("fa-eye-slash");
  }else{
    input.type = "password";
    icon.classList.remove("fa-eye-slash");
    icon.classList.add("fa-eye");
  }
}

const form = document.getElementById("signupForm");
const notifier = document.getElementById("notifier");
const mobileInput = document.getElementById("mobile");
const submitBtn = document.getElementById("submitBtn");
const spinner = document.getElementById("btnSpinner");
const btnText = document.getElementById("btnText");

function showNotifier(msg,type){
  notifier.textContent = msg;
  notifier.className = `notifier show ${type}`;
  setTimeout(()=>notifier.classList.remove("show"),2500);
}

mobileInput.addEventListener("input",e=>{
  e.target.value = e.target.value.replace(/\D/g,'').slice(0,10);
});

form.addEventListener("submit", async e=>{
  e.preventDefault();
  const data = Object.fromEntries(new FormData(form));

  if(data.mobile.length !== 10){
    showNotifier("Mobile number must be exactly 10 digits","warning");
    return;
  }

  if(!/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{6,}$/.test(data.password)){
    showNotifier("Password must be alphanumeric (min 6 characters)","warning");
    return;
  }

  if(data.password !== data.confirmPassword){
    showNotifier("Passwords do not match","warning");
    return;
  }

  submitBtn.disabled = true;
  btnText.style.visibility="hidden";
  spinner.style.display="block";

  try{
    const res = await fetch(
      "https://script.google.com/macros/s/AKfycbxcp5wXF3RnA5pv0FTlX7Bkad6s4xmXuLY4WhQk3xz7WJhM4-2Mpzi-rygF6TLoOEos/exec",
      {method:"POST",body:new URLSearchParams({...data,action:"signup"})}
    );

    const result = await res.json();

    spinner.style.display="none";
    btnText.style.visibility="visible";
    submitBtn.disabled = false;

    // ðŸ”´ DUPLICATE MOBILE + EXAM HANDLING (ROBUST)
if (
  result.status === "exists" ||
  result.status === "duplicate" ||
  result.exists === true ||
  (result.status === "error" && result.message?.toLowerCase().includes("exist"))
) {
  showNotifier(
    "This mobile number is already registered for the selected exam",
    "warning"
  );
  return;
}


    if(result.status === "success"){
      showNotifier("Registration Successful âœ…","success");

      document.getElementById("sName").innerText = data.name;
      document.getElementById("sMobile").innerText = data.mobile;
      document.getElementById("sPassword").innerText = data.password;

      setTimeout(()=>{
        form.style.display="none";
        document.getElementById("successView").style.display="block";
      },1200);
    }

  }catch{
    spinner.style.display="none";
    btnText.style.visibility="visible";
    submitBtn.disabled = false;
    showNotifier("Network error","warning");
  }
});
</script>

</body>
</html>
